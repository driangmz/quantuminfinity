<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Rainbow Elite Quantum Sync</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg: #030303;
            --card: #0d0d0e;
            --surface: #151517;
            --accent: #00ffaa;
            --text: #ffffff;
            --border: rgba(255, 255, 255, 0.1);
            --rainbow: linear-gradient(90deg, #ff595e, #ffca3a, #8ac926, #1982c4, #6a4c93);
        }

        * { box-sizing: border-box; -webkit-font-smoothing: antialiased; outline: none; }
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background-color: var(--bg); color: var(--text); margin: 0;
            padding: env(safe-area-inset-top) 15px 100px;
            display: flex; flex-direction: column; align-items: center;
        }

        .dashboard { width: 100%; max-width: 1100px; display: grid; grid-template-columns: 1.4fr 1fr; gap: 20px; }
        @media (max-width: 900px) { .dashboard { grid-template-columns: 1fr; } }

        .module {
            background: var(--card); border-radius: 32px; padding: 25px;
            border: 1px solid var(--border); box-shadow: 0 30px 60px rgba(0,0,0,0.7);
            position: relative; overflow: hidden;
        }

        h2 { font-size: 10px; text-transform: uppercase; letter-spacing: 2px; opacity: 0.5; margin: 0 0 15px 0; }

        /* --- 1. DATA ENTRY & SYNC --- */
        textarea {
            width: 100%; height: 110px; background: #000; border: 1px solid var(--border);
            border-radius: 18px; color: var(--accent); padding: 15px; font-family: monospace;
            font-size: 15px; transition: 0.3s;
        }
        textarea:focus { border-color: var(--accent); box-shadow: 0 0 20px rgba(0,255,170,0.1); }

        .control-row { display: flex; gap: 10px; margin-top: 12px; }
        .btn-mini { padding: 10px 15px; border-radius: 12px; font-size: 11px; font-weight: 800; border: 1px solid var(--border); background: #1a1a1a; color: #fff; cursor: pointer; transition: 0.2s; }
        .btn-mini:hover { border-color: var(--accent); }
        .btn-mini.danger { color: #ff3b30; }

        /* --- 2. WHEEL SYSTEM --- */
        .wheel-box { position: relative; width: 100%; aspect-ratio: 1; margin: 15px 0; }
        #wheelCanvas { width: 100%; height: 100%; border-radius: 50%; transition: transform var(--d, 0s) cubic-bezier(0.15, 0, 0, 1); }
        .pointer { position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid #ff3b30; z-index: 20; filter: drop-shadow(0 0 15px #ff3b30); }

        /* --- 3. RACE SYSTEM --- */
        .track { background: #000; border-radius: 20px; border: 1px solid var(--border); overflow: hidden; position: relative; }
        #raceCanvas { width: 100%; display: block; }
        .lights { position: absolute; top: 10px; right: 20px; display: flex; gap: 8px; }
        .light { width: 15px; height: 15px; border-radius: 50%; background: #222; border: 1px solid #444; }
        .light.red { background: #ff3b30; box-shadow: 0 0 10px #ff3b30; }
        .light.green { background: #32d74b; box-shadow: 0 0 10px #32d74b; }

        /* --- 4. NEURAL MATRIX --- */
        .matrix-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; margin: 15px 0; max-height: 200px; overflow-y: auto; padding: 5px; }
        .m-slot { aspect-ratio: 1; background: #000; border: 1px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 13px; font-weight: 800; transition: 0.1s; }
        .m-scan { border-color: var(--accent); background: rgba(0,255,170,0.1); }
        .m-winner { background: var(--accent); color: #000; transform: scale(1.1); box-shadow: 0 0 20px var(--accent); border:none; }

        /* --- 5. ROULETTE BOARD --- */
        .roulette-reel { height: 60px; background: #000; border-radius: 12px; border: 2px solid var(--accent); overflow: hidden; position: relative; margin: 15px 0; }
        .reel { transition: transform var(--d, 3s) cubic-bezier(0.15, 0, 0, 1); }
        .reel-item { height: 60px; display: flex; align-items: center; padding-left: 20px; font-weight: 900; font-size: 20px; color: var(--text); }

        /* --- UI UTILS --- */
        .btn { width: 100%; padding: 18px; border-radius: 20px; border: none; font-size: 14px; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; transition: 0.2s; }
        .btn-rainbow { background: var(--rainbow); color: #fff; }
        .btn-rainbow:active { transform: scale(0.96); }
        .btn:disabled { opacity: 0.3; pointer-events: none; }

        #status-bar { text-align: center; font-size: 10px; font-weight: 900; color: var(--accent); height: 20px; margin-top: 10px; text-transform: uppercase; letter-spacing: 1px; }

        /* --- MODAL --- */
        .overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: flex-end; justify-content: center; z-index: 1000; backdrop-filter: blur(15px); }
        .sheet { background: #111; width: 100%; max-width: 500px; padding: 40px 24px 60px; border-radius: 40px 40px 0 0; text-align: center; border-top: 3px solid var(--accent); transform: translateY(100%); transition: 0.4s cubic-bezier(0.1, 0, 0, 1); }
        .sheet.open { transform: translateY(0); }
        .win-display { font-size: 50px; font-weight: 900; color: var(--accent); margin: 25px 0; letter-spacing: -2px; }
    </style>
</head>
<body>

    <h1 style="font-weight: 900; letter-spacing: -3px; margin: 30px 0;">QUANTUM <span style="color:var(--accent)">INFINITY</span></h1>

    <div class="dashboard">
        <div class="module">
            <h2>Grand Prix Track</h2>
            <div class="track" id="stadium">
                <div class="lights">
                    <div class="light" id="l1"></div>
                    <div class="light" id="l2"></div>
                    <div class="light" id="l3"></div>
                </div>
                <canvas id="raceCanvas"></canvas>
            </div>
            <button class="btn btn-rainbow" id="raceBtn" onclick="runRace()">Start Race</button>

            <hr style="border:0; border-top:1px solid var(--border); margin:30px 0;">

            <h2>Deterministic Wheel</h2>
            <div class="wheel-box">
                <div class="pointer"></div>
                <canvas id="wheelCanvas" width="1000" height="1000"></canvas>
            </div>
            <button class="btn btn-rainbow" id="wBtn" onclick="runSpin()">Hard Stop Spin</button>
        </div>

        <div class="module">
            <h2>Global Input Matrix</h2>
            <textarea id="mainInput" oninput="globalSync()" placeholder="One name per line...">Alpha
Beta
Gamma
Delta
Epsilon</textarea>
            
            <div class="control-row">
                <button class="btn-mini" onclick="shuffleInput()">üîÄ Shuffle Matrix</button>
                <button class="btn-mini danger" onclick="clearInput()">üóëÔ∏è Purge All</button>
            </div>

            <div id="status-bar">System Calibrated</div>

            <hr style="border:0; border-top:1px solid var(--border); margin:25px 0;">

            <h2>Number Matrix Picker</h2>
            <div style="display:flex; gap:10px; margin-bottom:10px;">
                <input type="number" id="nMin" value="1" style="width:50%; background:#000; border:1px solid var(--border); color:var(--accent); padding:10px; border-radius:10px;">
                <input type="number" id="nMax" value="25" style="width:50%; background:#000; border:1px solid var(--border); color:var(--accent); padding:10px; border-radius:10px;" oninput="initMatrix()">
            </div>
            <div class="matrix-grid" id="mGrid"></div>
            <button class="btn" style="background:var(--accent); color:#000;" onclick="runMatrix()">Scan Matrix</button>

            <hr style="border:0; border-top:1px solid var(--border); margin:25px 0;">

            <h2>Mach Roulette</h2>
            <div class="roulette-reel">
                <div class="reel" id="reel"></div>
            </div>
            <button class="btn btn-rainbow" onclick="runRoulette()">Spin Reel</button>
        </div>
    </div>

    <div class="overlay" id="overlay" onclick="closeSheet()">
        <div class="sheet" id="sheet" onclick="event.stopPropagation()">
            <div style="width:50px; height:5px; background:#333; border-radius:10px; margin: 0 auto 25px;"></div>
            <p style="opacity:0.4; font-weight:900; font-size:10px; letter-spacing:2px;">ACCURACY VALIDATED</p>
            <div class="win-display" id="winnerLabel">--</div>
            <button class="btn btn-rainbow" onclick="removeWinner()">Remove from Matrix & Close</button>
            <button style="background:#222; color:#fff; margin-top:10px;" class="btn" onclick="closeSheet()">Keep Result</button>
        </div>
    </div>

<script>
/**
 * =========================================
 * QUANTUM LOGIC ENGINE (2026)
 * =========================================
 */

const timerSeq = [3, 5, 10, 5, 3, 3, 5, 10, 10];
const config = {
    colors: ['#FF595E', '#FFCA3A', '#8AC926', '#1982C4', '#6A4C93', '#F15BB5', '#00F5D4'],
    racerHeight: 45
};

let state = {
    items: [],
    numHistory: [],
    isSpinning: true,
    rotation: 0,
    velocity: 0.12,
    audioCtx: null
};

// --- AUDIO SYNTH ---
function playSfx(freq = 400, type = 'sine', duration = 0.1) {
    if (!state.audioCtx) state.audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    if (state.audioCtx.state === 'suspended') state.audioCtx.resume();
    const o = state.audioCtx.createOscillator();
    const g = state.audioCtx.createGain();
    o.type = type; o.frequency.setValueAtTime(freq, state.audioCtx.currentTime);
    g.gain.setValueAtTime(0.05, state.audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, state.audioCtx.currentTime + duration);
    o.connect(g); g.connect(state.audioCtx.destination);
    o.start(); o.stop(state.audioCtx.currentTime + duration);
}

// --- CORE SYNC ---
function globalSync() {
    const raw = document.getElementById('mainInput').value.split('\n').filter(l => l.trim() !== "");
    state.items = raw.map((n, i) => ({
        name: n.trim(),
        color: config.colors[i % config.colors.length]
    }));
    drawWheel();
    initReel();
    resizeTrack();
}

// --- NEW TOOLS ---
function shuffleInput() {
    const input = document.getElementById('mainInput');
    const lines = input.value.split('\n').filter(l => l.trim() !== "");
    for (let i = lines.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [lines[i], lines[j]] = [lines[j], lines[i]];
    }
    input.value = lines.join('\n');
    playSfx(1000, 'square', 0.05);
    globalSync();
}

function clearInput() {
    if(confirm("Purge entire Data Matrix? This cannot be undone.")) {
        document.getElementById('mainInput').value = "";
        globalSync();
        playSfx(200, 'sawtooth', 0.2);
    }
}

// --- PICKER 1: WHEEL ---
const wCanvas = document.getElementById('wheelCanvas');
const wCtx = wCanvas.getContext('2d');

function drawWheel() {
    if (!state.items.length) { wCtx.clearRect(0,0,1000,1000); return; }
    const arc = (Math.PI * 2) / state.items.length;
    wCtx.clearRect(0,0,1000,1000);
    state.items.forEach((it, i) => {
        const start = i * arc;
        wCtx.beginPath(); wCtx.fillStyle = it.color; wCtx.moveTo(500,500);
        wCtx.arc(500,500,495, start, start + arc); wCtx.fill();
        wCtx.save(); wCtx.translate(500,500); wCtx.rotate(start + arc/2);
        wCtx.textAlign="right"; wCtx.fillStyle="#fff"; wCtx.font="bold 35px Inter";
        wCtx.fillText(it.name.substring(0, 16), 460, 12); wCtx.restore();
    });
}

function loopWheel() {
    if (state.isSpinning) {
        state.rotation += state.velocity;
        wCanvas.style.transform = `rotate(${state.rotation}rad)`;
    }
    requestAnimationFrame(loopWheel);
}

function runSpin() {
    if (!state.isSpinning || state.items.length < 2) return;
    const d = timerSeq[Math.floor(Math.random() * timerSeq.length)];
    state.isSpinning = false;
    document.getElementById('wBtn').disabled = true;

    const winIdx = Math.floor(Math.random() * state.items.length);
    const arc = (Math.PI * 2) / state.items.length;
    const stopAngle = (Math.PI * 2) - (winIdx * arc) - (arc / 2) - (Math.PI / 2);
    const rotations = Math.PI * 30;
    const target = state.rotation + rotations + (stopAngle - (state.rotation % (Math.PI * 2)));

    wCanvas.style.transition = `transform ${d}s cubic-bezier(0.15, 0, 0, 1)`;
    wCanvas.style.transform = `rotate(${target}rad)`;

    setTimeout(() => {
        document.getElementById('status-bar').innerText = "VERIFYING ALIGNMENT...";
        setTimeout(() => {
            handleWinner(state.items[winIdx].name);
            state.rotation = target;
            state.isSpinning = true;
            document.getElementById('wBtn').disabled = false;
            wCanvas.style.transition = 'none';
        }, 2000);
    }, d * 1000);
}

// --- PICKER 2: GRAND PRIX ---
const rCanvas = document.getElementById('raceCanvas');
const rCtx = rCanvas.getContext('2d');
let racers = [];

function resizeTrack() {
    rCanvas.width = document.getElementById('stadium').offsetWidth;
    rCanvas.height = Math.max(240, state.items.length * config.racerHeight + 60);
}

function runRace() {
    if (state.items.length < 2) return;
    const btn = document.getElementById('raceBtn'); btn.disabled = true;
    const d = timerSeq[Math.floor(Math.random() * timerSeq.length)];
    const winIdx = Math.floor(Math.random() * state.items.length);
    racers = state.items.map((it, i) => ({ name: it.name, color: it.color, y: i * config.racerHeight + 50, progress: 0 }));
    setTimeout(() => document.getElementById('l1').classList.add('red'), 500);
    setTimeout(() => document.getElementById('l2').classList.add('red'), 1000);
    setTimeout(() => {
        document.getElementById('l3').classList.add('green');
        playSfx(800, 'square', 0.2);
        const start = performance.now();
        const animate = (now) => {
            const elapsed = (now - start) / 1000;
            const p = Math.min(elapsed / d, 1);
            rCtx.clearRect(0,0, rCanvas.width, rCanvas.height);
            racers.forEach((r, i) => {
                const bias = (i === winIdx) ? 1 : (0.8 + Math.random() * 0.18);
                r.progress = Math.pow(p, 0.8) * bias;
                rCtx.fillStyle = r.color;
                rCtx.beginPath(); rCtx.roundRect(20 + r.progress * (rCanvas.width - 120), r.y - 15, 60, 30, 15); rCtx.fill();
                rCtx.fillStyle = "#000"; rCtx.font = "900 10px Inter";
                rCtx.fillText(r.name.substring(0, 10), 30 + r.progress * (rCanvas.width - 120), r.y + 4);
            });
            if (p < 1) requestAnimationFrame(animate);
            else {
                document.getElementById('status-bar').innerText = "PHOTO FINISH VERIFYING...";
                setTimeout(() => {
                    handleWinner(state.items[winIdx].name);
                    btn.disabled = false;
                    document.querySelectorAll('.light').forEach(l => l.className = 'light');
                }, 2000);
            }
        };
        requestAnimationFrame(animate);
    }, 1500);
}

// --- PICKER 3: MATRIX ---
function initMatrix() {
    const min = parseInt(document.getElementById('nMin').value);
    const max = parseInt(document.getElementById('nMax').value);
    const g = document.getElementById('mGrid'); g.innerHTML = '';
    for(let i=min; i<=max; i++) {
        const d = document.createElement('div');
        d.className = 'm-slot'; d.innerText = i; d.id = 'm-' + i;
        g.appendChild(d);
    }
}

function runMatrix() {
    const min = parseInt(document.getElementById('nMin').value);
    const max = parseInt(document.getElementById('nMax').value);
    const d = timerSeq[Math.floor(Math.random() * timerSeq.length)];
    let win;
    do { win = Math.floor(Math.random() * (max - min + 1)) + min; } while (state.numHistory.includes(win));
    state.numHistory.push(win); if(state.numHistory.length > 10) state.numHistory.shift();
    let elap = 0;
    const itv = setInterval(() => {
        document.querySelectorAll('.m-slot').forEach(s => s.classList.remove('m-scan'));
        const r = Math.floor(Math.random() * (max - min + 1)) + min;
        const slot = document.getElementById('m-' + r);
        if(slot) slot.classList.add('m-scan');
        playSfx(600, 'sine', 0.05);
        elap += 100;
        if(elap >= d * 1000) {
            clearInterval(itv);
            document.querySelectorAll('.m-slot').forEach(s => s.classList.remove('m-scan'));
            document.getElementById('m-' + win).classList.add('m-winner');
            setTimeout(() => handleWinner("Number " + win), 2000);
        }
    }, 100);
}

// --- PICKER 4: ROULETTE ---
function initReel() {
    const r = document.getElementById('reel'); r.innerHTML = '';
    state.items.slice(0, 10).forEach(it => {
        const d = document.createElement('div'); d.className = 'reel-item';
        d.innerText = it.name; d.style.color = it.color; r.appendChild(d);
    });
}

function runRoulette() {
    if(state.items.length < 2) return;
    const d = timerSeq[Math.floor(Math.random() * timerSeq.length)];
    const reel = document.getElementById('reel'); reel.innerHTML = '';
    for(let i=0; i<60; i++) state.items.forEach(it => {
        const d = document.createElement('div'); d.className = 'reel-item';
        d.innerText = it.name; d.style.color = it.color; reel.appendChild(d);
    });
    const winIdx = Math.floor(Math.random() * state.items.length);
    const scroll = ( (state.items.length * 40) + winIdx ) * 60;
    reel.style.setProperty('--d', d + 's');
    reel.style.transform = `translateY(-${scroll}px)`;
    setTimeout(() => {
        document.getElementById('status-bar').innerText = "VERIFYING REEL...";
        setTimeout(() => handleWinner(state.items[winIdx].name), 2000);
    }, d * 1000);
}

// --- WINNER LOGIC ---
function handleWinner(label) {
    document.getElementById('winnerLabel').innerText = label;
    document.getElementById('overlay').style.display = 'flex';
    setTimeout(() => document.getElementById('sheet').classList.add('open'), 10);
    confetti({ particleCount: 200, spread: 100, origin: { y: 0.7 } });
    playSfx(400, 'triangle', 0.4);
}

function removeWinner() {
    const winner = document.getElementById('winnerLabel').innerText.replace("Number ", "");
    const lines = document.getElementById('mainInput').value.split('\n');
    const filtered = lines.filter(l => l.trim() !== winner);
    document.getElementById('mainInput').value = filtered.join('\n');
    globalSync();
    closeSheet();
}

function closeSheet() {
    document.getElementById('sheet').classList.remove('open');
    setTimeout(() => {
        document.getElementById('overlay').style.display = 'none';
        document.querySelectorAll('.m-winner').forEach(s => s.classList.remove('m-winner'));
        document.getElementById('status-bar').innerText = "System Calibrated";
    }, 350);
}

window.onload = () => {
    globalSync();
    loopWheel();
    initMatrix();
};
</script>
</body>
</html>
